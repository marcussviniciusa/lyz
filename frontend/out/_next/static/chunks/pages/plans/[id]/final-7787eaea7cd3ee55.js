(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{2605:(e,a,n)=>{"use strict";n.r(a),n.d(a,{default:()=>c});var s=n(7876),l=n(4232),o=n(9099),t=n(8230),i=n.n(t),r=n(4842),d=n(2471),m=n(1059);let c=()=>{var e,a,n,t,c,u,x,p,f;let{user:h,loading:v}=(0,d.As)(),_=(0,o.useRouter)(),{id:g}=_.query,[y,b]=(0,l.useState)(null),[j,N]=(0,l.useState)({diagnosis:"",treatment_plan:"",nutritional_recommendations:{foods_to_include:"",foods_to_avoid:"",meal_timing:"",supplements:""},lifestyle_recommendations:{exercise:"",sleep:"",stress_management:"",other:""},follow_up:"",additional_notes:""}),[w,P]=(0,l.useState)(!0),[C,E]=(0,l.useState)(!1),[q,k]=(0,l.useState)(!1),[A,S]=(0,l.useState)(null),[T,z]=(0,l.useState)(null);(0,l.useEffect)(()=>{h||v||_.push("/auth/login")},[h,v,_]),(0,l.useEffect)(()=>{let e=async()=>{if(g)try{P(!0);let r=(await m.a7.getPlanById(g)).data.plan||null;if(b(r),null==r?void 0:r.final_plan){var e,a,n,s,l,o,t,i;let d={diagnosis:r.final_plan.diagnosis||"",treatment_plan:r.final_plan.treatment_plan||"",nutritional_recommendations:{foods_to_include:(null===(e=r.final_plan.nutritional_recommendations)||void 0===e?void 0:e.foods_to_include)||"",foods_to_avoid:(null===(a=r.final_plan.nutritional_recommendations)||void 0===a?void 0:a.foods_to_avoid)||"",meal_timing:(null===(n=r.final_plan.nutritional_recommendations)||void 0===n?void 0:n.meal_timing)||"",supplements:(null===(s=r.final_plan.nutritional_recommendations)||void 0===s?void 0:s.supplements)||""},lifestyle_recommendations:{exercise:(null===(l=r.final_plan.lifestyle_recommendations)||void 0===l?void 0:l.exercise)||"",sleep:(null===(o=r.final_plan.lifestyle_recommendations)||void 0===o?void 0:o.sleep)||"",stress_management:(null===(t=r.final_plan.lifestyle_recommendations)||void 0===t?void 0:t.stress_management)||"",other:(null===(i=r.final_plan.lifestyle_recommendations)||void 0===i?void 0:i.other)||""},follow_up:r.final_plan.follow_up||"",additional_notes:r.final_plan.additional_notes||""};N(d)}S(null)}catch(e){S("Erro ao carregar detalhes do plano: "+(e.message||"Tente novamente mais tarde")),console.error("Error fetching plan details:",e)}finally{P(!1)}};h&&g&&e()},[h,g]),(0,l.useEffect)(()=>{if(y){let e=[];y.questionnaire_data||e.push("question\xe1rio"),y.lab_results||e.push("resultados laboratoriais"),y.tcm_observations||e.push("observa\xe7\xf5es TCM"),y.timeline_data||e.push("timeline"),y.ifm_matrix||e.push("matriz IFM"),e.length>0&&S("\xc9 necess\xe1rio preencher: ".concat(e.join(", ")," antes de gerar o plano final."))}},[y]);let I=e=>{let{name:a,value:n}=e.target;if(a.includes(".")){let[e,s]=a.split(".");N(a=>{let l={...a,nutritional_recommendations:a.nutritional_recommendations||{foods_to_include:"",foods_to_avoid:"",meal_timing:"",supplements:""},lifestyle_recommendations:a.lifestyle_recommendations||{exercise:"",sleep:"",stress_management:"",other:""}};return{...l,[e]:{...l[e],[s]:n}}})}else N(e=>({...e,[a]:n}))},R=async()=>{if(g)try{var e,a,n,s,l,o,t,i,r,d;E(!0),S(null);let c=await m.a7.generatePlan(g);if(c.data&&((null===(e=c.data.plan)||void 0===e?void 0:e.final_plan)||c.data.final_plan)){let e=(null===(a=c.data.plan)||void 0===a?void 0:a.final_plan)||c.data.final_plan,m={diagnosis:e.diagnosis||"",treatment_plan:e.treatment_plan||"",nutritional_recommendations:{foods_to_include:(null===(n=e.nutritional_recommendations)||void 0===n?void 0:n.foods_to_include)||"",foods_to_avoid:(null===(s=e.nutritional_recommendations)||void 0===s?void 0:s.foods_to_avoid)||"",meal_timing:(null===(l=e.nutritional_recommendations)||void 0===l?void 0:l.meal_timing)||"",supplements:(null===(o=e.nutritional_recommendations)||void 0===o?void 0:o.supplements)||""},lifestyle_recommendations:{exercise:(null===(t=e.lifestyle_recommendations)||void 0===t?void 0:t.exercise)||"",sleep:(null===(i=e.lifestyle_recommendations)||void 0===i?void 0:i.sleep)||"",stress_management:(null===(r=e.lifestyle_recommendations)||void 0===r?void 0:r.stress_management)||"",other:(null===(d=e.lifestyle_recommendations)||void 0===d?void 0:d.other)||""},follow_up:e.follow_up||"",additional_notes:e.additional_notes||""};N(m),z("Plano gerado com sucesso!")}else S("N\xe3o foi poss\xedvel gerar o plano. Tente novamente mais tarde."),console.error("Resposta inv\xe1lida da API:",c.data)}catch(e){S("Erro ao gerar plano: "+(e.message||"Tente novamente mais tarde")),console.error("Error generating plan:",e)}finally{E(!1)}},F=async e=>{if(e.preventDefault(),g)try{var a,n,s,l,o,t,i,r;k(!0),z(null),S(null);let e={diagnosis:j.diagnosis||"",treatment_plan:j.treatment_plan||"",nutritional_recommendations:{foods_to_include:(null===(a=j.nutritional_recommendations)||void 0===a?void 0:a.foods_to_include)||"",foods_to_avoid:(null===(n=j.nutritional_recommendations)||void 0===n?void 0:n.foods_to_avoid)||"",meal_timing:(null===(s=j.nutritional_recommendations)||void 0===s?void 0:s.meal_timing)||"",supplements:(null===(l=j.nutritional_recommendations)||void 0===l?void 0:l.supplements)||""},lifestyle_recommendations:{exercise:(null===(o=j.lifestyle_recommendations)||void 0===o?void 0:o.exercise)||"",sleep:(null===(t=j.lifestyle_recommendations)||void 0===t?void 0:t.sleep)||"",stress_management:(null===(i=j.lifestyle_recommendations)||void 0===i?void 0:i.stress_management)||"",other:(null===(r=j.lifestyle_recommendations)||void 0===r?void 0:r.other)||""},follow_up:j.follow_up||"",additional_notes:j.additional_notes||""};await m.a7.updateFinalPlan(g,e),z("Plano final salvo com sucesso!"),setTimeout(()=>{_.push("/plans/".concat(g))},1500)}catch(e){S("Erro ao salvar plano final: "+(e.message||"Tente novamente mais tarde")),console.error("Error saving final plan:",e)}finally{k(!1)}};if(v||w)return(0,s.jsx)(r.A,{title:"Carregando Plano Final - Lyz",children:(0,s.jsx)("div",{className:"flex justify-center py-20",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"spinner-border h-10 w-10 text-primary-600 animate-spin"}),(0,s.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:"Carregando dados..."})]})})});if(!h)return null;let L=!y||!y.questionnaire_data||!y.lab_results||!y.tcm_observations||!y.timeline_data||!y.ifm_matrix;return A&&L?(0,s.jsx)(r.A,{title:"Etapa Anterior Pendente - Lyz",children:(0,s.jsx)("div",{className:"max-w-3xl mx-auto px-4 py-10",children:(0,s.jsxs)("div",{className:"bg-yellow-50 p-6 rounded-lg",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-yellow-700 mb-2",children:"Etapas anteriores pendentes"}),(0,s.jsx)("p",{className:"text-yellow-600 mb-4",children:A}),(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap gap-3",children:[!(null==y?void 0:y.questionnaire_data)&&(0,s.jsx)(i(),{href:"/plans/".concat(g,"/questionnaire"),className:"btn-primary",children:"Ir para o Question\xe1rio"}),(null==y?void 0:y.questionnaire_data)&&!(null==y?void 0:y.lab_results)&&(0,s.jsx)(i(),{href:"/plans/".concat(g,"/lab"),className:"btn-primary",children:"Ir para Resultados Laboratoriais"}),(null==y?void 0:y.questionnaire_data)&&(null==y?void 0:y.lab_results)&&!(null==y?void 0:y.tcm_observations)&&(0,s.jsx)(i(),{href:"/plans/".concat(g,"/tcm"),className:"btn-primary",children:"Ir para Observa\xe7\xf5es TCM"}),(null==y?void 0:y.questionnaire_data)&&(null==y?void 0:y.lab_results)&&(null==y?void 0:y.tcm_observations)&&!(null==y?void 0:y.timeline_data)&&(0,s.jsx)(i(),{href:"/plans/".concat(g,"/timeline"),className:"btn-primary",children:"Ir para Timeline"}),(null==y?void 0:y.questionnaire_data)&&(null==y?void 0:y.lab_results)&&(null==y?void 0:y.tcm_observations)&&(null==y?void 0:y.timeline_data)&&!(null==y?void 0:y.ifm_matrix)&&(0,s.jsx)(i(),{href:"/plans/".concat(g,"/ifm"),className:"btn-primary",children:"Ir para Matriz IFM"}),(0,s.jsx)(i(),{href:"/plans/".concat(g),className:"btn-outline",children:"Voltar ao Plano"})]})]})})}):(0,s.jsx)(r.A,{title:"Plano Final - Lyz",children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-10",children:[(0,s.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-primary","data-component-name":"FinalPlanPage",children:"Plano Final"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Paciente: ",(null==y?void 0:null===(e=y.patient_data)||void 0===e?void 0:e.name)||""]})]}),(0,s.jsx)(i(),{href:"/plans/".concat(g),className:"btn-outline",children:"Voltar ao Plano"})]}),T&&(0,s.jsx)("div",{className:"mb-6 bg-green-50 p-4 rounded-md",children:(0,s.jsx)("p",{className:"text-green-700",children:T})}),A&&!L&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 p-4 rounded-md",children:(0,s.jsx)("p",{className:"text-red-700",children:A})}),(0,s.jsxs)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Gera\xe7\xe3o do Plano"}),(0,s.jsx)("button",{type:"button",onClick:R,disabled:C||L,className:"btn-primary ".concat(C||L?"opacity-50 cursor-not-allowed":""),children:C?"Gerando...":"Gerar Plano com IA"})]}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Clique no bot\xe3o para gerar automaticamente um plano baseado em todas as informa\xe7\xf5es fornecidas anteriormente. Voc\xea poder\xe1 editar o plano gerado conforme necess\xe1rio."})]}),(0,s.jsxs)("form",{onSubmit:F,className:"p-6",children:[(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Diagn\xf3stico"}),(0,s.jsx)("textarea",{name:"diagnosis",value:j.diagnosis,onChange:I,rows:4,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Diagn\xf3stico funcional integrado baseado em todas as an\xe1lises"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Plano de Tratamento"}),(0,s.jsx)("textarea",{name:"treatment_plan",value:j.treatment_plan,onChange:I,rows:6,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Vis\xe3o geral da abordagem terap\xeautica e interven\xe7\xf5es principais"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recomenda\xe7\xf5es Nutricionais"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alimentos a Incluir"}),(0,s.jsx)("textarea",{name:"nutritional_recommendations.foods_to_include",value:(null===(a=j.nutritional_recommendations)||void 0===a?void 0:a.foods_to_include)||"",onChange:I,rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Alimentos recomendados e seus benef\xedcios"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alimentos a Evitar"}),(0,s.jsx)("textarea",{name:"nutritional_recommendations.foods_to_avoid",value:(null===(n=j.nutritional_recommendations)||void 0===n?void 0:n.foods_to_avoid)||"",onChange:I,rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Alimentos a serem limitados ou evitados"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Frequ\xeancia e Hor\xe1rio das Refei\xe7\xf5es"}),(0,s.jsx)("textarea",{name:"nutritional_recommendations.meal_timing",value:(null===(t=j.nutritional_recommendations)||void 0===t?void 0:t.meal_timing)||"",onChange:I,rows:2,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Orienta\xe7\xf5es sobre frequ\xeancia, hor\xe1rio e estrutura das refei\xe7\xf5es"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Suplementos"}),(0,s.jsx)("textarea",{name:"nutritional_recommendations.supplements",value:(null===(c=j.nutritional_recommendations)||void 0===c?void 0:c.supplements)||"",onChange:I,rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Suplementos recomendados, dosagens e justificativas"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recomenda\xe7\xf5es de Estilo de Vida"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exerc\xedcios"}),(0,s.jsx)("textarea",{name:"lifestyle_recommendations.exercise",value:(null===(u=j.lifestyle_recommendations)||void 0===u?void 0:u.exercise)||"",onChange:I,rows:2,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Recomenda\xe7\xf5es sobre atividade f\xedsica e movimento"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sono"}),(0,s.jsx)("textarea",{name:"lifestyle_recommendations.sleep",value:(null===(x=j.lifestyle_recommendations)||void 0===x?void 0:x.sleep)||"",onChange:I,rows:2,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Recomenda\xe7\xf5es para melhorar a qualidade do sono"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gerenciamento de Estresse"}),(0,s.jsx)("textarea",{name:"lifestyle_recommendations.stress_management",value:(null===(p=j.lifestyle_recommendations)||void 0===p?void 0:p.stress_management)||"",onChange:I,rows:2,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"T\xe9cnicas de redu\xe7\xe3o de estresse e pr\xe1ticas de consci\xeancia plena"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Outras Recomenda\xe7\xf5es"}),(0,s.jsx)("textarea",{name:"lifestyle_recommendations.other",value:(null===(f=j.lifestyle_recommendations)||void 0===f?void 0:f.other)||"",onChange:I,rows:2,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Outras sugest\xf5es para melhorar a qualidade de vida"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Acompanhamento"}),(0,s.jsx)("textarea",{name:"follow_up",value:j.follow_up,onChange:I,rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Plano de acompanhamento, frequ\xeancia de consultas e exames recomendados"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Observa\xe7\xf5es Adicionais"}),(0,s.jsx)("textarea",{name:"additional_notes",value:j.additional_notes,onChange:I,rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Quaisquer outras informa\xe7\xf5es ou recomenda\xe7\xf5es relevantes"})]})]}),(0,s.jsxs)("div",{className:"mt-8 flex justify-end space-x-4",children:[(0,s.jsx)(i(),{href:"/plans/".concat(g),className:"btn-outline",children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:q,className:"btn-primary",children:q?"Salvando...":"Salvar Plano"})]})]})]})]})})}},4842:(e,a,n)=>{"use strict";n.d(a,{A:()=>m});var s=n(7876);n(4232);var l=n(7328),o=n.n(l),t=n(2471),i=n(8230),r=n.n(i),d=n(9099);let m=e=>{let{children:a,title:n="Lyz - Planos C\xedclicos Personalizados"}=e,{user:l,logout:i,isAuthenticated:m,isSuperadmin:c}=(0,t.As)(),u=(0,d.useRouter)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o(),{children:[(0,s.jsx)("title",{children:n}),(0,s.jsx)("meta",{name:"description",content:"Sistema Lyz para planos personalizados baseados em ciclicidade feminina"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,s.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,s.jsx)(r(),{href:"/",className:"text-2xl font-bold text-primary-600",children:"Lyz"})}),m&&(0,s.jsxs)("nav",{className:"ml-6 flex space-x-8",children:[(0,s.jsx)(r(),{href:"/dashboard",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat("/dashboard"===u.pathname?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Dashboard"}),(0,s.jsx)(r(),{href:"/plans",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat(u.pathname.startsWith("/plans")?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Meus Planos"}),c&&(0,s.jsx)(r(),{href:"/admin/dashboard",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat(u.pathname.startsWith("/admin")?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Administra\xe7\xe3o"})]})]}),(0,s.jsx)("div",{className:"flex items-center",children:m?(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["Ol\xe1, ",null==l?void 0:l.name.split(" ")[0]]}),(0,s.jsx)("button",{onClick:i,className:"text-sm text-gray-700 hover:text-primary-600",children:"Sair"})]}):(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(r(),{href:"/auth/login",className:"text-sm font-medium text-gray-700 hover:text-primary-600",children:"Entrar"}),(0,s.jsx)(r(),{href:"/auth/register",className:"text-sm font-medium bg-primary-600 text-white px-3 py-1 rounded-md hover:bg-primary-700",children:"Registrar"})]})})]})})}),(0,s.jsx)("main",{className:"flex-grow",children:a}),(0,s.jsx)("footer",{className:"bg-white border-t border-gray-200 py-4 mt-auto",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("p",{className:"text-center text-sm text-gray-500",children:["\xa9 ",new Date().getFullYear()," Lyz Healthcare. Todos os direitos reservados."]})})})]})]})}},7886:(e,a,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/plans/[id]/final",function(){return n(2605)}])}},e=>{var a=a=>e(e.s=a);e.O(0,[695,636,593,792],()=>a(7886)),_N_E=e.O()}]);