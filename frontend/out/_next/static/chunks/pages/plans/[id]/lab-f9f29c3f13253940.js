(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[494],{1752:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>m});var t=a(7876),r=a(4232),l=a(9099),n=a(8230),i=a.n(n),o=a(4842),d=a(2471),c=a(1059);let m=()=>{var e,s,a,n;let{user:m,loading:x}=(0,d.As)(),u=(0,l.useRouter)(),{id:h}=u.query,[p,v]=(0,r.useState)(null),[b,g]=(0,r.useState)(!0),[j,f]=(0,r.useState)(!1),[y,N]=(0,r.useState)(null),[w,_]=(0,r.useState)(null),[k,P]=(0,r.useState)(""),[L,E]=(0,r.useState)(null),[R,q]=(0,r.useState)(null),A=(0,r.useRef)(null);(0,r.useEffect)(()=>{m||x||u.push("/auth/login")},[m,x,u]),(0,r.useEffect)(()=>{let e=async()=>{if(h)try{var e;g(!0);let s=(await c.a7.getPlanById(h)).data.plan||null;v(s),(null==s?void 0:null===(e=s.lab_results)||void 0===e?void 0:e.notes)&&P(s.lab_results.notes),N(null)}catch(e){N("Erro ao carregar detalhes do plano: "+(e.message||"Tente novamente mais tarde")),console.error("Error fetching plan details:",e)}finally{g(!1)}};m&&h&&e()},[m,h]),(0,r.useEffect)(()=>{p&&!p.questionnaire_data&&N("\xc9 necess\xe1rio preencher o question\xe1rio antes de enviar os resultados laboratoriais")},[p]);let C=async e=>{var s;if(e.preventDefault(),h){if(!L&&!(null==p?void 0:null===(s=p.lab_results)||void 0===s?void 0:s.file_url)){N("Por favor, selecione um arquivo de resultados laboratoriais");return}try{f(!0),_(null),N(null),L&&await c.a7.uploadLabResults(h,L);let e=await c.a7.getPlanById(h);v(e.data.plan||null),_("Resultados laboratoriais enviados com sucesso!"),setTimeout(()=>{u.push("/plans/".concat(h,"/tcm"))},1500)}catch(e){N("Erro ao enviar resultados: "+(e.message||"Tente novamente mais tarde")),console.error("Error uploading lab results:",e)}finally{f(!1)}}};return x||b?(0,t.jsx)(o.A,{title:"Carregando Resultados Laboratoriais - Lyz",children:(0,t.jsx)("div",{className:"flex justify-center py-20",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"spinner-border h-10 w-10 text-primary-600 animate-spin"}),(0,t.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:"Carregando dados..."})]})})}):m?y&&!p?(0,t.jsx)(o.A,{title:"Erro - Lyz",children:(0,t.jsx)("div",{className:"max-w-3xl mx-auto px-4 py-10",children:(0,t.jsxs)("div",{className:"bg-red-50 p-6 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-red-700 mb-2",children:"Ocorreu um erro"}),(0,t.jsx)("p",{className:"text-red-600",children:y}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(i(),{href:"/plans",className:"text-primary-600 font-medium hover:text-primary-500",children:"← Voltar para a lista de planos"})})]})})}):(0,t.jsx)(o.A,{title:"Resultados Laboratoriais - Lyz",children:(0,t.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-10",children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-primary","data-component-name":"LabResultsPage",children:"Resultados Laboratoriais"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Paciente: ",(null==p?void 0:null===(e=p.patient_data)||void 0===e?void 0:e.name)||""]})]}),(0,t.jsx)(i(),{href:"/plans/".concat(h),className:"btn-outline",children:"Voltar ao Plano"})]}),w&&(0,t.jsx)("div",{className:"mb-6 bg-green-50 p-4 rounded-md",children:(0,t.jsx)("p",{className:"text-green-700",children:w})}),y&&(0,t.jsx)("div",{className:"mb-6 bg-red-50 p-4 rounded-md",children:(0,t.jsx)("p",{className:"text-red-700",children:y})}),p&&!p.questionnaire_data?(0,t.jsxs)("div",{className:"bg-yellow-50 p-6 rounded-lg mb-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-yellow-700 mb-2",children:"Etapa anterior pendente"}),(0,t.jsx)("p",{className:"text-yellow-600 mb-4",children:"\xc9 necess\xe1rio preencher o question\xe1rio antes de enviar os resultados laboratoriais."}),(0,t.jsx)(i(),{href:"/plans/".concat(h,"/questionnaire"),className:"btn-primary",children:"Ir para o Question\xe1rio"})]}):(0,t.jsxs)("form",{onSubmit:C,className:"bg-white shadow-sm rounded-lg p-6",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Arquivo de Resultados"}),(0,t.jsxs)("div",{className:"flex flex-col items-center p-6 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:[(0,t.jsx)("input",{type:"file",ref:A,onChange:e=>{if(e.target.files&&e.target.files[0]){let s=e.target.files[0];if(!["application/pdf","image/jpeg","image/png"].includes(s.type)){N("Por favor, selecione um arquivo PDF, JPEG ou PNG");return}if(s.size>5242880){N("O arquivo deve ter no m\xe1ximo 5MB");return}if(E(s),N(null),s.type.startsWith("image/")){let e=new FileReader;e.onloadend=()=>{q(e.result)},e.readAsDataURL(s)}else q(null)}},className:"hidden",accept:".pdf,.jpg,.jpeg,.png"}),(null==p?void 0:null===(s=p.lab_results)||void 0===s?void 0:s.file_url)?(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("svg",{className:"mx-auto h-12 w-12 text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Arquivo j\xe1 enviado"})]}),(0,t.jsx)("a",{href:p.lab_results.file_url,target:"_blank",rel:"noopener noreferrer",className:"btn-outline text-sm",children:"Visualizar Arquivo"}),(0,t.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.click()},className:"ml-2 btn-text text-sm",children:"Substituir"})]}):R?(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("img",{src:R,alt:"Preview",className:"mx-auto h-40 object-contain"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:null==L?void 0:L.name})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{E(null),q(null)},className:"btn-text text-sm",children:"Remover"})]}):(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Arraste e solte um arquivo, ou"}),(0,t.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.click()},className:"mt-2 btn-text",children:"Selecione um arquivo"}),(0,t.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"PDF, PNG ou JPG at\xe9 5MB"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Notas sobre os Resultados"}),(0,t.jsx)("textarea",{value:k,onChange:e=>P(e.target.value),rows:6,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Descreva observa\xe7\xf5es importantes sobre os resultados laboratoriais, destacando valores fora da refer\xeancia ou que mere\xe7am aten\xe7\xe3o."})]}),(null==p?void 0:null===(a=p.lab_results)||void 0===a?void 0:a.analyzed_data)&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"An\xe1lise dos Resultados"}),(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md",children:[(0,t.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-2",children:"An\xe1lise IA"}),(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(p.lab_results.analyzed_data,null,2)})})]})]})]}),(0,t.jsxs)("div",{className:"mt-8 flex justify-end space-x-4",children:[(0,t.jsx)(i(),{href:"/plans/".concat(h),className:"btn-outline",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",disabled:j||!L&&!(null==p?void 0:null===(n=p.lab_results)||void 0===n?void 0:n.file_url),className:"btn-primary",children:j?"Enviando...":"Salvar e Continuar"})]})]})]})}):null}},4396:(e,s,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/plans/[id]/lab",function(){return a(1752)}])},4842:(e,s,a)=>{"use strict";a.d(s,{A:()=>c});var t=a(7876);a(4232);var r=a(7328),l=a.n(r),n=a(2471),i=a(8230),o=a.n(i),d=a(9099);let c=e=>{let{children:s,title:a="Lyz - Planos C\xedclicos Personalizados"}=e,{user:r,logout:i,isAuthenticated:c,isSuperadmin:m}=(0,n.As)(),x=(0,d.useRouter)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l(),{children:[(0,t.jsx)("title",{children:a}),(0,t.jsx)("meta",{name:"description",content:"Sistema Lyz para planos personalizados baseados em ciclicidade feminina"}),(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,t.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,t.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"flex justify-between h-16",children:[(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,t.jsx)(o(),{href:"/",className:"text-2xl font-bold text-primary-600",children:"Lyz"})}),c&&(0,t.jsxs)("nav",{className:"ml-6 flex space-x-8",children:[(0,t.jsx)(o(),{href:"/dashboard",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat("/dashboard"===x.pathname?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Dashboard"}),(0,t.jsx)(o(),{href:"/plans",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat(x.pathname.startsWith("/plans")?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Meus Planos"}),m&&(0,t.jsx)(o(),{href:"/admin/dashboard",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat(x.pathname.startsWith("/admin")?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Administra\xe7\xe3o"})]})]}),(0,t.jsx)("div",{className:"flex items-center",children:c?(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["Ol\xe1, ",null==r?void 0:r.name.split(" ")[0]]}),(0,t.jsx)("button",{onClick:i,className:"text-sm text-gray-700 hover:text-primary-600",children:"Sair"})]}):(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsx)(o(),{href:"/auth/login",className:"text-sm font-medium text-gray-700 hover:text-primary-600",children:"Entrar"}),(0,t.jsx)(o(),{href:"/auth/register",className:"text-sm font-medium bg-primary-600 text-white px-3 py-1 rounded-md hover:bg-primary-700",children:"Registrar"})]})})]})})}),(0,t.jsx)("main",{className:"flex-grow",children:s}),(0,t.jsx)("footer",{className:"bg-white border-t border-gray-200 py-4 mt-auto",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("p",{className:"text-center text-sm text-gray-500",children:["\xa9 ",new Date().getFullYear()," Lyz Healthcare. Todos os direitos reservados."]})})})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[695,636,593,792],()=>s(4396)),_N_E=e.O()}]);